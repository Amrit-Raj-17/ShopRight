<html lang="en">
    <head>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ShopRight - Welcome</title>
        <link rel="stylesheet" href="style.css" />
    </head>

    <body class="login-page">
        <div class="overlay"></div>
        <div class="login-container">
            <h1>Welcome to <span>ShopRight</span></h1>
            <p>AI-driven Emotion-Based Fashion Shopping</p>

            <div class="button-group">
                <button class="btn login-btn" onclick="showForm('login')">Login</button>
                <button class="btn register-btn" onclick="showForm('register')">Register</button>
            </div>

            <div id="message" style="margin-top:20px; color:#ffcc70; font-weight:bold;"></div>

            <form id="loginForm" style="display:none; margin-top:30px;" onsubmit="loginUser(event)">
                <h3>Login</h3>
                <input type="email" id="login_email" placeholder="Email" required><br><br>
                <input type="password" id="login_password" placeholder="Password" required><br><br>
                <button type="submit" class="btn">Login</button>
            </form>

            <form id="registerForm" style="display:none; margin-top:30px;" onsubmit="registerUser(event)">
            <h3>Register</h3>
                <input type="text" id="reg_name" placeholder="Full Name" required><br><br>
                <input type="email" id="reg_email" placeholder="Email" required><br><br>
                <input type="password" id="reg_password" placeholder="Password" required><br><br>
                <button type="submit" class="btn">Register</button>
            </form>
        </div>
    </body>
    <script>

        const SUPABASE_URL = "https://mcjrdxfmuvoqriuofmxt.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1janJkeGZtdXZvcXJpdW9mbXh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2MDM5MzUsImV4cCI6MjA3NTE3OTkzNX0._PyztILx33tDKS_iLZ2VS1HDgYR-VWwixSDXo3ItMYM";
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function showForm(type) {
            document.getElementById("loginForm").style.display = type === 'login' ? 'block' : 'none';
            document.getElementById("registerForm").style.display = type === 'register' ? 'block' : 'none';
            document.getElementById("message").textContent = "";
        }

        async function registerUser(event) {
            event.preventDefault();
            const name = document.getElementById("reg_name").value;
            const email = document.getElementById("reg_email").value;
            const password = document.getElementById("reg_password").value;

            const { data, error } = await supabaseClient.auth.signUp({
                email,
                password,
                options: {
                    data: { name: name }
                }
            });

            if (error) {
                document.getElementById("message").textContent = "❌ " + error.message;
            } else {
                document.getElementById("message").textContent = "✅ Registration successful! Please login.";
                setTimeout(() => {
                    document.getElementById("registerForm").reset();
                    showForm('login');
                }, 1000);
            }
        }

        async function loginUser(event) {
            event.preventDefault();
            const email = document.getElementById("login_email").value;
            const password = document.getElementById("login_password").value;

            const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });

            if (error || !data) {
                document.getElementById("message").textContent = "❌ Invalid email or password.";
            } else {
                document.getElementById("message").textContent = "✅ Login successful! Redirecting...";
                setTimeout(() => {
                    window.location.href = "home.html";
                }, 1000);
            }
        }
    </script>
</html>
